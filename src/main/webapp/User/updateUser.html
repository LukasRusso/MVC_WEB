<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Update User</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
<style type="text/css">
	body {
		background-color: gray;
		align-items: center;		
	}
	button {
		color: black;
	}	
	#page {
		margin: auto;
		background-color: white;
		box-shadow: 10px 10px 10px 10px black;
		border: 2px black solid;
		border-radius: 10px;
		text-align: center;
		width: 70%;
		height: 100%;
	}
</style>
</head>
<body>
	<div id="page">
		<h1>Update User</h1>					
			<p>
				<label for="user_id">ID:</label>
				<input type="number" id="user_id" name="user_id" value="" disabled>
			</p>
			<p>
				<label for="user_name">Name:</label>
				<input type="text" id="user_name" name="user_name" placeholder="Name of User" required>
			</p>		
			<p>
				<label for="user_birthday">Birthday:</label>
				<input type="date" id="user_birthday" name="user_birthday">
			</p>
			<p>
				<label for="user_email">E-mail:</label>
				<input type="email" id="user_email" name="user_email" placeholder="user@email.com" required>
			</p>
			<p>
				<label for="user_color">Color:</label>
				<input type="color" id="user_color" name="user_color">
			</p>
			<p>
				<label for="user_cpf">CPF:</label>
				<input type="text" id="user_cpf" name="user_cpf" placeholder="123.456.789-11"
					pattern="[0-9]{3}.[0-9]{3}.[0-9]{3}-[0-9]{2}" required disabled>
			</p>
			<p>	
								
				<button onclick="updateUser()">Update</button>			
				<button><a href="/MVC_WEB/home.html" style="text-decoration: none; color: black;">Cancel</a></button>						
			</p>
	</div>
</body>
<script type="text/javascript">
	setTimeout(updateHtml, 1);
	
	function updateHtml() {	
		var route = "/MVC_WEB/UserAPI?user_cpf=" + window.location.search.split('=')[1];
				
		$.ajax({
			url: route, 
			headers: {"Content-Type":"application/json", "charset":"UTF-8"}, 
			method: "GET", 
			success: function(data){
				document.getElementById("user_id").value = data.User.id;
				document.getElementById("user_name").value = data.User.name;
				document.getElementById("user_birthday").value = new Date(data.User.birthday).toISOString().split('T')[0];
				document.getElementById("user_email").value = data.User.email;
				document.getElementById("user_color").value = data.User.color;
				document.getElementById("user_cpf").value = data.User.cpf;
			},
			error: function(response){
				alert("User not found!");
				window.location.href = "/MVC_WEB/User/userConfig.html";
			}});
	}
	
	function updateUser() {	
		var route = "/MVC_WEB/UserAPI";
		var user = {
			"user_id": document.getElementById("user_id").value,		
			"user_name": document.getElementById("user_name").value,
			"user_birthday": document.getElementById("user_birthday").value,
			"user_email": document.getElementById("user_email").value,
			"user_color": document.getElementById("user_color").value,
			"user_cpf": document.getElementById("user_cpf").value
		};
		
		$.ajax({
			url: route, 
			headers: {"Content-Type":"application/json", "charset":"UTF-8"}, 
			method: "PUT", data: user,
			success: function(){
				window.location.href = "/MVC_WEB/User/indexUser.html";
			},
			error: function(response){
				alert(response.status + " - User couldn't be update!");
			}});
	}
</script>
</html>