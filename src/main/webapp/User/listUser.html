<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Update User</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style type="text/css">
	body {
		background-color: gray;
		align-items: center;		
	}
	button {
		color: black;
	}	
	#page {
		margin: auto;
		background-color: white;
		box-shadow: 10px 10px 10px 10px black;
		border: 2px black solid;
		border-radius: 10px;
		text-align: center;
		width: 70%;
		height: 100%;
	}
	#Table {
		width: 100%;
	}
</style>
</head>
<body>
	<div id="page">
		<h1>List of Users</h1>					
		<table id="Table">
			<thead>
				<tr>
					<th scope="col" style="text-align:center;">ID</th>
					<th scope="col" style="text-align:center;">Name</th>
					<th scope="col" style="text-align:center;">Action</th>
				</tr>
			</thead>
		</table>
	</div>
</body>
<script type="text/javascript">
	setTimeout(updateHtml, 1);
	
	function updateHtml() {	
		var route = "/MVC_WEB/UserAPI?list_users=true";
				
		$.ajax({url: route, method: "GET"})
			.done(function (response) {				
				var data = response;
				
				if(data.Status == 200){					
					return updateList(data);
				}
				else{
					window.location.href = route;
				}
			})
	}
	
	function updateList(object){
		var list = object.Users;
		
		var table = document.getElementById("Table");
		var tbdy = document.getElementById("objList");
		
		if(tbdy == null){
			tbdy = document.createElement("tbody");
			tbdy.id = "objList";
		} else {
			tbdy.innerHTML = "";
		}
		
		var row;		
		for(i = 0; i < list.length; i++){
			console.log(list[i]);
			row = tableRow(list[i], (tbdy.children.length % 2 == 0));
			console.log(row);
			
			if(row != null) tbdy.appendChild(row);
		}
		table.appendChild(tbdy);
	}
	
	function tableRow(user, pair){
		var row = document.createElement("tr");		
		
		if(pair) row.style.background = "rgba(0,0,0,.05)";
		
		var cell_id = document.createElement("td");
		cell_id.style.textAlign = "center";
		cell_id.innerHTML = user.id;
		
		var cell_name = document.createElement("td");
		cell_name.style.textAlign = "center";
		cell_name.innerHTML = user.name;
		
		var cell_actions = document.createElement("td");
		cell_actions.style.textAlign = "center";
		
		var link_view = document.createElement("a");
		link_view.href = "/MVC_WEB/UserAPI?user_cpf=" + user.cpf;
		var view = document.createElement("i");
		view.className = "fa fa-eye";
		view.style.fontSize = "24px";
		view.style.color = "darkorange";
		
		link_view.appendChild(view);
		
		
		var link_update = document.createElement("a");
		link_update.href = "/MVC_WEB/User/updateUser.html?user_cpf=" + user.cpf;
		var update = document.createElement("i");
		update.className = "fa fa-pencil";
		update.style.fontSize = "24px";
		update.style.color = "blue";
		
		link_update.appendChild(update);		
		
		var link_del = document.createElement("a");
		link_del.href = "javascript:deleteUser('"+ user.cpf +"')";		
		var del = document.createElement("i");
		del.className = "fa fa-times-circle-o";
		del.style.fontSize = "24px";
		del.style.color = "red";
		
		link_del.appendChild(del);
				
		cell_actions.appendChild(link_view);
		cell_actions.appendChild(link_update);
		cell_actions.appendChild(link_del);
		
		row.appendChild(cell_id);
		row.appendChild(cell_name);
		row.appendChild(cell_actions);
		
		return row;
	}
	
	function deleteUser(cpf){
		var del = confirm("User will be deleted, continue?");
		
		if(del){	
			var route = "/MVC_WEB/UserAPI?user_cpf=" + cpf;
			
			$.ajax({url: route, method: "DELETE",
				success: function(){									
					return updateHtml();					
				},
				error: function(response){					
					if(response.status == 409){
						alert(response.status + " - Error: " + response.responseJSON.Error);
					}
					else {
						alert(response.status + " - User couldn't be deleted!");
					}
				}
			});
		}
	}
	
</script>
</html>