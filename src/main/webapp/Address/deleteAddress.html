<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Delete Address</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
	<style type="text/css">
		body {
			background-color: gray;
			align-items: center;		
		}
		
		button, input#delete {
			margin-bottom: 20px;		
			border-radius: 10px;		
		}	
		
		button a {
			position: relative;
			text-decoration: none;		
			color: black;
		}
		
		#page {
			margin: auto;
			background-color: white;
			box-shadow: 10px 10px 10px 10px black;
			border: 2px black solid;
			border-radius: 10px;
			text-align: center;
			width: 70%;
			height: 100%;
		}
		
	</style>
</head>
<body>
	<div id="page">
		<h1>Delete Address</h1>		
			<p>
				<label for="user_cpf">CPF:</label>
				<input type="text" id="user_cpf" name="user_cpf" placeholder="123.456.789-11"
					onchange="maskCPF(this)">
			</p>			
			<p>	
				<button>
					<a href="/MVC_WEB/home.html">Cancel</a>
				</button>					
				<input id="delete" type="button" value="Delete" onclick="getUser()">
			</p>
	</div>	
</body>
<script type="text/javascript">
	function maskCPF(element){
		var value = "";
		var cpf = element.value.replaceAll(".","").replaceAll("-","");		
		for(i = 0; i < cpf.length; i++){
			if(i == 3) value += cpf.substr(0, 3) + "." + cpf.substr(i, 1);
			else if(i == 6) value +=  cpf.substr(4, 2) + "." + cpf.substr(i, 1);
			else if(i == 9) value +=  cpf.substr(7, 2) + "-" + cpf.substr(i, 2);			
		}
		element.value = value;
	}
	
	function getUser(){
		var del = confirm("User\'s Address will be deleted, continue?");		
		if(!del) return;
		
		var data = {
			"user_cpf": document.getElementById("user_cpf").value
		};
		
		var route = "/MVC_WEB/UserAPI?user_cpf=" + data.user_cpf;
		
		$.ajax({
			url: route, 
			headers: {"Content-Type":"application/json", "charset":"UTF-8"}, 
			method: "GET",
			success: function(response){
				deleteAddress(response.User);
			},
			error: function(responseError){
				alert("User couldn\'t be found!");
			}}
		);	
	}
	
	function deleteAddress(user){
		var userId = {
			"addr_userId": user.id	
		};
		
		if(user != null){
			$.ajax({
				url: "/MVC_WEB/AddressAPI", 
				headers: {"Content-Type":"application/json", "charset":"UTF-8"}, 
				method: "DELETE",
				data: userId,
				success: function(response){					
					alert("Address was successfully deleted!");
					window.location.href = "/MVC_WEB/home.html";
				},
				error: function(responseError){					
					alert("Address couldn\'t be deleted!");
				}});	
		}
	}
</script>
</html>